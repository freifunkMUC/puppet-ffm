
# base system
```
As a first step you should install ubuntu 14.04 lts on your machine.
Debian Jessie should also work.
```


# bootstrapping the installation
```
sudo apt-get -y upgrade
curl https://apt.puppetlabs.com/puppetlabs-release-trusty.deb -O
sudo dpkg -i puppetlabs-release-trusty.deb
sudo apt-get update

sudo apt-get -y install git puppet make ruby-dev
sudo gem install librarian-puppet

cd /opt
sudo git clone -b automatic_gw_01 https://github.com/freifunkMUC/puppet-ffm.git
sudo chown -R $USER:$USER puppet-ffm
cd puppet-ffm
librarian-puppet install
```


# configuration
/usr/bin/editor hieradata/$(facter fqdn).yaml


Example hieradata/$( facter fqdn ).yaml file
```
---

community: 'ffmuc'
batman_bridge: 'brffmuc'

profiles::firewall::route_traffic_through_vpn_tunnel: false
runs_on_box_behind_nat: true

fastd_connection_interface: 'eth0'
vpn_interface: 'eth0'
fastd::fastd_connection_ip: '192.168.178.100'

gateway_number: 100
fastd::secret_key: 'private key generated by "fastd --generate-key"'
fastd::public_key: 'public key generated by "fastd --generate-key"'

```


If you would like to use Vagrant for setting up a Virtual Machine
you will need to change "configs.yaml" as well.

In the configs.yaml which comes with the code you can see a working
example. The one thing you need to change for sure is "boxname".
Use the name of a ubuntu 14.04.1_lts vagrant-box you prepared or
downloaded for this purpose.
The example-file also refers to a provider 'libvirt' which you may
install with "vagrant plugin install vagrant-libvirt".


#### box behind nat
Please look up how to set up the right firewall-rules for your operating
system to forward the port to your Virtual Machine if you want to use this
kind of setup.


#### With Vagrant
After you modified "configs.yaml" to your needs, you may hit "vagrant up"
into your terminal.
Make sure, that your Operating System is allowing you to add the NFS-folders
and that the firewall is not blocking nfs.


#### Without Vagrant
This changes the configuration and packages of your machine where you
are logged in right now!
Etckeeper comes with this installation so you may check for changes there as well.

sudo ./apply.sh


#### A new Kernel for Ubuntu 14.04. LTS
Because puppet installed you a new kernel, you need to reboot your machine.
It is possible, that fastd isn't correctly setting up the bat0 interface after
a reboot. If this is the case, you need to restart fastd by hand.


# fastd clients
In the file "hieradata/client-peers.yaml" exists an array of public keys of
fastd clients.
---

fastd::client_pubkeys:
  - 'insert first key here...'
  - 'insert second key here...'
  - 'insert third key here...'
  - '...'


If you change the client-peers you should just run puppet again, either with
"sudo ./apply.sh" or with "vagrant provision".



